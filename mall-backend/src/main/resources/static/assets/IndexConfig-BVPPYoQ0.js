import{f as V,g as S,o as U,c as R,w as a,a as x,e as t,j as C,E as g,k as _,r as i,_ as z,b as $,h as E,F as q,v as G,s as M,x as I,t as A,y as j,z as O}from"./index-BJIwiziA.js";const H={class:"dialog-footer"},J={__name:"DialogAddGood",props:{type:String,configType:Number,reload:Function},setup(T,{expose:k}){const s=T,F=V(null),e=S({visible:!1,ruleForm:{name:"",link:"",id:"",sort:""},rules:{name:[{required:"true",message:"名称不能为空",trigger:["change"]}],id:[{required:"true",message:"编号不能为空",trigger:["change"]}],sort:[{required:"true",message:"排序不能为空",trigger:["change"]}]},id:""}),b=d=>{_.get(`/indexConfigs/${d}`).then(n=>{e.ruleForm={name:n.configName,id:n.goodsId,link:n.redirectUrl,sort:n.configRank}})},o=d=>{e.visible=!0,d?(e.id=d,b(d)):e.ruleForm={name:"",id:"",link:"",sort:""}},u=()=>{e.visible=!1},h=()=>{F.value.validate(d=>{if(d){if(e.ruleForm.id<0){g.error("商品编号不能小于 0");return}s.type=="add"?_.post("/indexConfigs",{configType:s.configType||3,configName:e.ruleForm.name,redirectUrl:e.ruleForm.link,goodsId:e.ruleForm.id,configRank:e.ruleForm.sort}).then(()=>{g.success("添加成功"),e.visible=!1,s.reload&&s.reload()}):_.put("/indexConfigs",{configId:e.id,configType:s.configType||3,configName:e.ruleForm.name,redirectUrl:e.ruleForm.link,goodsId:e.ruleForm.id,configRank:e.ruleForm.sort}).then(()=>{g.success("修改成功"),e.visible=!1,s.reload&&s.reload()})}})};return k({open:o,close:u}),(d,n)=>{const p=i("el-input"),f=i("el-form-item"),v=i("el-form"),l=i("el-button"),c=i("el-dialog");return U(),R(c,{title:T.type=="add"?"添加商品":"修改商品",modelValue:e.visible,"onUpdate:modelValue":n[5]||(n[5]=r=>e.visible=r),width:"400px"},{footer:a(()=>[x("span",H,[t(l,{onClick:n[4]||(n[4]=r=>e.visible=!1)},{default:a(()=>n[6]||(n[6]=[C("取 消")])),_:1}),t(l,{type:"primary",onClick:h},{default:a(()=>n[7]||(n[7]=[C("确 定")])),_:1})])]),default:a(()=>[t(v,{model:e.ruleForm,rules:e.rules,ref_key:"formRef",ref:F,"label-width":"100px",class:"good-form"},{default:a(()=>[t(f,{label:"商品名称",prop:"name"},{default:a(()=>[t(p,{type:"text",modelValue:e.ruleForm.name,"onUpdate:modelValue":n[0]||(n[0]=r=>e.ruleForm.name=r)},null,8,["modelValue"])]),_:1}),t(f,{label:"跳转链接",prop:"link"},{default:a(()=>[t(p,{type:"text",modelValue:e.ruleForm.link,"onUpdate:modelValue":n[1]||(n[1]=r=>e.ruleForm.link=r)},null,8,["modelValue"])]),_:1}),t(f,{label:"商品编号",prop:"id"},{default:a(()=>[t(p,{type:"number",min:"0",modelValue:e.ruleForm.id,"onUpdate:modelValue":n[2]||(n[2]=r=>e.ruleForm.id=r)},null,8,["modelValue"])]),_:1}),t(f,{label:"排序值",prop:"sort"},{default:a(()=>[t(p,{type:"number",modelValue:e.ruleForm.sort,"onUpdate:modelValue":n[3]||(n[3]=r=>e.ruleForm.sort=r)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}},K={class:"header"},L=["href"],Q=["onClick"],W={__name:"IndexConfig",setup(T){const k={hot:3,new:4,recommend:5},s=G(),F=M(),e=V(null),b=V(null),o=S({loading:!1,tableData:[],multipleSelection:[],total:0,currentPage:1,pageSize:10,type:"add",configType:3});s.beforeEach(l=>{["hot","new","recommend"].includes(l.name)&&(o.configType=k[l.name],o.currentPage=1,u())}),$(()=>{o.configType=k[F.name],u()});const u=()=>{o.loading=!0,_.get("/indexConfigs",{params:{pageNumber:o.currentPage,pageSize:o.pageSize,configType:o.configType}}).then(l=>{o.tableData=l.list,o.total=l.totalCount,o.currentPage=l.currPage,o.loading=!1})},h=()=>{o.type="add",b.value.open()},d=l=>{o.type="edit",b.value.open(l)},n=l=>{o.multipleSelection=l},p=()=>{if(!o.multipleSelection.length){g.error("请选择项");return}_.delete("/indexConfigs",{data:{ids:o.multipleSelection.map(l=>l.configId)}}).then(()=>{g.success("删除成功"),u()})},f=l=>{_.delete("/indexConfigs",{data:{ids:[l]}}).then(()=>{g.success("删除成功"),u()})},v=l=>{o.currentPage=l,u()};return(l,c)=>{const r=i("el-button"),w=i("el-popconfirm"),m=i("el-table-column"),N=i("el-table"),B=i("el-pagination"),D=i("el-card");return U(),E(q,null,[t(D,{class:"index-container"},{header:a(()=>[x("div",K,[t(r,{type:"primary",icon:I(j),onClick:h},{default:a(()=>c[0]||(c[0]=[C("增加")])),_:1},8,["icon"]),t(w,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:p},{reference:a(()=>[t(r,{type:"danger",icon:I(O)},{default:a(()=>c[1]||(c[1]=[C("批量删除")])),_:1},8,["icon"])]),_:1})])]),default:a(()=>[t(N,{load:o.loading,ref_key:"multipleTable",ref:e,data:o.tableData,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:n},{default:a(()=>[t(m,{type:"selection",width:"55"}),t(m,{prop:"configName",label:"商品名称"}),t(m,{label:"跳转链接"},{default:a(y=>[x("a",{target:"_blank",href:y.row.redirectUrl},A(y.row.redirectUrl),9,L)]),_:1}),t(m,{prop:"configRank",label:"排序值",width:"120"}),t(m,{prop:"goodsId",label:"商品编号",width:"200"}),t(m,{prop:"createTime",label:"添加时间",width:"200"}),t(m,{label:"操作",width:"100"},{default:a(y=>[x("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:P=>d(y.row.configId)},"修改",8,Q),t(w,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:P=>f(y.row.configId)},{reference:a(()=>c[2]||(c[2]=[x("a",{style:{cursor:"pointer"}},"删除",-1)])),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["load","data"]),t(B,{background:"",layout:"prev, pager, next",total:o.total,"page-size":o.pageSize,"current-page":o.currentPage,onCurrentChange:v},null,8,["total","page-size","current-page"])]),_:1}),t(J,{ref_key:"addGood",ref:b,reload:u,type:o.type,configType:o.configType},null,8,["type","configType"])],64)}}},Y=z(W,[["__scopeId","data-v-3305bab7"]]);export{Y as default};
