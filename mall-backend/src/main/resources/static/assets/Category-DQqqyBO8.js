import{f as L,s as N,g as z,r as s,o as R,c as $,w as r,a as v,e as l,j as h,k as f,E as m,b as T,A as q,d as E,v as U,x as V,y as A,z as M}from"./index-BJIwiziA.js";const j={class:"dialog-footer"},O={__name:"DialogAddCategory",props:{type:String,reload:Function},setup(C,{expose:_}){const d=C,b=L(null),t=N(),e=z({visible:!1,categoryLevel:1,parentId:0,ruleForm:{name:"",rank:""},rules:{name:[{required:"true",message:"名称不能为空",trigger:["change"]}],rank:[{required:"true",message:"编号不能为空",trigger:["change"]}]},id:""}),u=i=>{f.get(`/categories/${i}`).then(o=>{e.ruleForm={name:o.categoryName,rank:o.categoryRank},e.parentId=o.parentId,e.categoryLevel=o.categoryLevel})},x=i=>{if(e.visible=!0,i)e.id=i,u(i);else{const{level:o=1,parent_id:g=0}=t.query;e.ruleForm={name:"",rank:""},e.parentId=g,e.categoryLevel=o}},w=()=>{e.visible=!1},F=()=>{b.value.validate(i=>{i&&(d.type=="add"?f.post("/categories",{categoryLevel:e.categoryLevel,parentId:e.parentId,categoryName:e.ruleForm.name,categoryRank:e.ruleForm.rank}).then(()=>{m.success("添加成功"),e.visible=!1,d.reload&&d.reload()}):f.put("/categories",{categoryId:e.id,categoryLevel:e.categoryLevel,parentId:e.categoryLevel,categoryName:e.ruleForm.name,categoryRank:e.ruleForm.rank}).then(()=>{m.success("修改成功"),e.visible=!1,d.reload&&d.reload()}))})};return _({open:x,close:w}),(i,o)=>{const g=s("el-input"),k=s("el-form-item"),a=s("el-form"),n=s("el-button"),p=s("el-dialog");return R(),$(p,{title:C.type=="add"?"添加分类":"修改分类",modelValue:e.visible,"onUpdate:modelValue":o[3]||(o[3]=c=>e.visible=c),width:"400px"},{footer:r(()=>[v("span",j,[l(n,{onClick:o[2]||(o[2]=c=>e.visible=!1)},{default:r(()=>o[4]||(o[4]=[h("取 消")])),_:1}),l(n,{type:"primary",onClick:F},{default:r(()=>o[5]||(o[5]=[h("确 定")])),_:1})])]),default:r(()=>[l(a,{model:e.ruleForm,rules:e.rules,ref_key:"formRef",ref:b,"label-width":"100px",class:"good-form"},{default:r(()=>[l(k,{label:"分类名称",prop:"name"},{default:r(()=>[l(g,{type:"text",modelValue:e.ruleForm.name,"onUpdate:modelValue":o[0]||(o[0]=c=>e.ruleForm.name=c)},null,8,["modelValue"])]),_:1}),l(k,{label:"排序值",prop:"rank"},{default:r(()=>[l(g,{type:"number",modelValue:e.ruleForm.rank,"onUpdate:modelValue":o[1]||(o[1]=c=>e.ruleForm.rank=c)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}},G={class:"header"},H=["onClick"],J=["onClick"],Q={__name:"Category",setup(C){const _=L(null),d=U(),b=N(),t=z({loading:!1,tableData:[],multipleSelection:[],total:0,currentPage:1,pageSize:10,type:"add",level:1,parent_id:0});T(()=>{u()}),q(()=>{console.log(t.pageSize)});const e=d.afterEach(a=>{["category","level2","level3"].includes(a.name)&&u()});E(()=>{e()});const u=()=>{const{level:a=1,parent_id:n=0}=b.query;t.loading=!0,f.get("/categories",{params:{pageNumber:t.currentPage,pageSize:t.pageSize,categoryLevel:a,parentId:n}}).then(p=>{t.tableData=p.list,t.total=p.totalCount,t.currentPage=p.currPage,t.loading=!1,t.level=a,t.parentId=n})},x=a=>{t.currentPage=a,u()},w=a=>{const n=a.categoryLevel+1;if(n==4){m.error("没有下一级");return}d.push({name:`level${n}`,query:{level:n,parent_id:a.categoryId}})},F=()=>{t.type="add",_.value.open()},i=a=>{t.type="edit",_.value.open(a)},o=a=>{t.multipleSelection=a},g=()=>{if(!t.multipleSelection.length){m.error("请选择项");return}f.delete("/categories",{data:{ids:t.multipleSelection.map(a=>a.categoryId)}}).then(()=>{m.success("删除成功"),u()})},k=a=>{f.delete("/categories",{data:{ids:[a]}}).then(()=>{m.success("删除成功"),u()})};return(a,n)=>{const p=s("el-button"),c=s("el-popconfirm"),y=s("el-table-column"),B=s("el-table"),D=s("el-pagination"),P=s("el-card");return R(),$(P,{class:"category-container"},{header:r(()=>[v("div",G,[l(p,{type:"primary",icon:V(A),onClick:F},{default:r(()=>n[0]||(n[0]=[h("增加")])),_:1},8,["icon"]),l(c,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:g},{reference:r(()=>[l(p,{type:"danger",icon:V(M)},{default:r(()=>n[1]||(n[1]=[h("批量删除")])),_:1},8,["icon"])]),_:1})])]),default:r(()=>[l(B,{loading:t.loading,ref:"multipleTable",data:t.tableData,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:o},{default:r(()=>[l(y,{type:"selection",width:"55"}),l(y,{prop:"categoryName",label:"分类名称"}),l(y,{prop:"categoryRank",label:"排序值",width:"120"}),l(y,{prop:"createTime",label:"添加时间",width:"200"}),l(y,{label:"操作",width:"220"},{default:r(I=>[v("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:S=>i(I.row.categoryId)},"修改",8,H),v("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:S=>w(I.row)},"下级分类",8,J),l(c,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:S=>k(I.row.categoryId)},{reference:r(()=>n[2]||(n[2]=[v("a",{style:{cursor:"pointer"}},"删除",-1)])),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["loading","data"]),l(D,{background:"",layout:"prev, pager, next",total:t.total,"page-size":t.pageSize,"current-page":t.currentPage,onCurrentChange:x},null,8,["total","page-size","current-page"]),l(O,{ref_key:"addCate",ref:_,reload:u,type:t.type},null,8,["type"])]),_:1})}}};export{Q as default};
