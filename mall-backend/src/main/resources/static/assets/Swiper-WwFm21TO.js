import{_ as I,f as D,g as j,u as T,n as $,o as f,c as V,w as a,a as b,e as o,j as h,h as z,E as m,k as _,r as n,b as N,F as A,x as P,t as E,y as q,z as M}from"./index-BJIwiziA.js";const G=["src"],H={class:"dialog-footer"},J={__name:"DialogAddSwiper",props:{type:String,reload:Function},setup(k,{expose:p}){const l=k,u=D(null),e=j({uploadImgServer:T,token:$("token")||"",visible:!1,ruleForm:{url:"",link:"",sort:""},rules:{url:[{required:"true",message:"图片不能为空",trigger:["change"]}],sort:[{required:"true",message:"排序不能为空",trigger:["change"]}]},id:""}),y=r=>{_.get(`/carousels/${r}`).then(t=>{e.ruleForm={url:t.carouselUrl,link:t.redirectUrl,sort:t.carouselRank}})},v=r=>{const t=r.name.split(".")[1]||"";if(!["jpg","jpeg","png"].includes(t))return m.error("请上传 jpg、jpeg、png 格式的图片"),!1},w=r=>{e.ruleForm.url=r.data||""},s=r=>{e.visible=!0,r?(e.id=r,y(r)):e.ruleForm={url:"",link:"",sort:""}},c=()=>{e.visible=!1},g=()=>{console.log(u.value.validate),u.value.validate(r=>{r&&(l.type=="add"?_.post("/carousels",{carouselUrl:e.ruleForm.url,redirectUrl:e.ruleForm.link,carouselRank:e.ruleForm.sort}).then(()=>{m.success("添加成功"),e.visible=!1,l.reload&&l.reload()}):_.put("/carousels",{carouselId:e.id,carouselUrl:e.ruleForm.url,redirectUrl:e.ruleForm.link,carouselRank:e.ruleForm.sort}).then(()=>{m.success("修改成功"),e.visible=!1,l.reload&&l.reload()}))})};return p({open:s,close:c}),(r,t)=>{const x=n("Plus"),F=n("el-icon"),S=n("el-upload"),i=n("el-form-item"),U=n("el-input"),B=n("el-form"),C=n("el-button"),R=n("el-dialog");return f(),V(R,{title:k.type=="add"?"添加轮播图":"修改轮播图",modelValue:e.visible,"onUpdate:modelValue":t[3]||(t[3]=d=>e.visible=d),width:"400px"},{footer:a(()=>[b("span",H,[o(C,{onClick:t[2]||(t[2]=d=>e.visible=!1)},{default:a(()=>t[4]||(t[4]=[h("取 消")])),_:1}),o(C,{type:"primary",onClick:g},{default:a(()=>t[5]||(t[5]=[h("确 定")])),_:1})])]),default:a(()=>[o(B,{model:e.ruleForm,rules:e.rules,ref_key:"formRef",ref:u,"label-width":"100px",class:"good-form"},{default:a(()=>[o(i,{label:"图片",prop:"url"},{default:a(()=>[o(S,{class:"avatar-uploader",action:e.uploadImgServer,accept:"jpg,jpeg,png",headers:{token:e.token},"show-file-list":!1,"before-upload":v,"on-success":w},{default:a(()=>[e.ruleForm.url?(f(),z("img",{key:0,style:{width:"200px",height:"100px",border:"1px solid #e9e9e9"},src:e.ruleForm.url,class:"avatar"},null,8,G)):(f(),V(F,{key:1,class:"avatar-uploader-icon"},{default:a(()=>[o(x)]),_:1}))]),_:1},8,["action","headers"])]),_:1}),o(i,{label:"跳转链接",prop:"link"},{default:a(()=>[o(U,{type:"text",modelValue:e.ruleForm.link,"onUpdate:modelValue":t[0]||(t[0]=d=>e.ruleForm.link=d)},null,8,["modelValue"])]),_:1}),o(i,{label:"排序值",prop:"sort"},{default:a(()=>[o(U,{type:"number",modelValue:e.ruleForm.sort,"onUpdate:modelValue":t[1]||(t[1]=d=>e.ruleForm.sort=d)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}},K=I(J,[["__scopeId","data-v-085a82c5"]]),L={class:"header"},O=["src"],Q=["href"],X={__name:"Swiper",setup(k){const p=D(),l=j({loading:!1,tableData:[],currentPage:1,pageSize:10,type:"add",multipleSelection:[],total:0});N(()=>{u()});const u=()=>{l.loading=!0,_.get("/carousels",{params:{pageNumber:l.currentPage,pageSize:l.pageSize}}).then(s=>{l.tableData=s.list,l.total=s.totalCount,l.currentPage=s.currPage,l.loading=!1})},e=()=>{console.log("addSwiper",p.value),l.type="add",p.value.open()},y=s=>{l.multipleSelection=s},v=()=>{if(!l.multipleSelection.length){m.error("请选择项");return}_.delete("/carousels",{data:{ids:l.multipleSelection.map(s=>s.carouselId)}}).then(()=>{m.success("删除成功"),u()})},w=s=>{l.currentPage=s,u()};return(s,c)=>{const g=n("el-button"),r=n("el-popconfirm"),t=n("el-table-column"),x=n("el-table"),F=n("el-pagination"),S=n("el-card");return f(),z(A,null,[o(S,{class:"swiper-container"},{header:a(()=>[b("div",L,[o(g,{type:"primary",icon:P(q),onClick:e},{default:a(()=>c[0]||(c[0]=[h("增加")])),_:1},8,["icon"]),o(r,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:v},{reference:a(()=>[o(g,{type:"danger",icon:P(M)},{default:a(()=>c[1]||(c[1]=[h("批量删除")])),_:1},8,["icon"])]),_:1})])]),default:a(()=>[o(x,{load:l.loading,ref:"multipleTable",data:l.tableData,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:y},{default:a(()=>[o(t,{type:"selection",width:"55"}),o(t,{label:"轮播图",width:"200"},{default:a(i=>[b("img",{style:{width:"150px",height:"150px"},src:i.row.carouselUrl,alt:"轮播图"},null,8,O)]),_:1}),o(t,{label:"跳转链接"},{default:a(i=>[b("a",{target:"_blank",href:i.row.redirectUrl},E(i.row.redirectUrl),9,Q)]),_:1}),o(t,{prop:"carouselRank",label:"排序值",width:"120"}),o(t,{prop:"createTime",label:"添加时间",width:"200"})]),_:1},8,["load","data"]),o(F,{background:"",layout:"prev, pager, next",total:l.total,"page-size":l.pageSize,"current-page":l.currentPage,onCurrentChange:w},null,8,["total","page-size","current-page"])]),_:1}),o(K,{ref_key:"addSwiper",ref:p,reload:u,type:l.type},null,8,["type"])],64)}}};export{X as default};
